<!DOCTYPE html>
<html lang="en">
    
    <head>
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:100,300,400,600" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="normalize.css">
        <link rel="stylesheet" type="text/css" href="grid.css">
        <link rel="stylesheet" type="text/css" href="style.css">
        <title>Budget App</title>
    </head>
    
    <body>
        <header>
            <div class = "top">
                <div class = "row">
                    <div class = "col span-1-of-3">
                        <a class = "arrow" id = "prev-year" href="#">&#8249;</a>
                    </div>

                    <div class = "col span-1-of-3">
                        <div class = "year"> YEAR </div>
                    </div>

                    <div class = "col span-1-of-3">
                        <a class = "arrow" id = "next-year" href="#"> &#8250; </a>
                    </div>
                </div>   
            </div>
        </header>

        <section class = "month">
            
            <div class="row">
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "January" href="#">JAN<a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-January">Income: ---</div>
                        <div class = "data expense-month" id = "expense-January">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-January">Budget: ---</div>
                        
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "February" href="month.html">FEB</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-February">Income: ---</div>
                        <div class = "data expense-month" id = "expense-February">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-February">Budget: ---</div>   
                    
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "March" href="month.html">MAR</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-March">Income: ---</div>
                        <div class = "data expense-month" id = "expense-March">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-March">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "April" href="month.html">APR</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-April">Income: ---</div>
                        <div class = "data expense-month" id = "expense-April">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-April">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "May" href="month.html">MAY</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-May">Income: ---</div>
                        <div class = "data expense-month" id = "expense-May">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-May">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "June" href="month.html">JUN</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-June">Income: ---</div>
                        <div class = "data expense-month" id = "expense-June">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-June">Budget: ---</div>
                </div>
                
            </div>
    
            
            <div class="row">
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "July" href="month.html">JUL<a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-July">Income: ---</div>
                        <div class = "data expense-month" id = "expense-July">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-July">Budget: ---</div>
                        
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "August" href="month.html">AUG</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-August">Income: ---</div>
                        <div class = "data expense-month" id = "expense-August">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-August">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "September" href="month.html">SEP</a>
                        <hr width = "70%">
                        <div class = "data data income-month" id="income-September">Income: ---</div>
                        <div class = "data expense-month" id = "expense-September">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-September">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "October" href="month.html">OCT</a>
                        <hr width = "70%">
                        <div class = "data data income-month" id="income-October">Income: ---</div>
                        <div class = "data expense-month" id = "expense-October">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-October">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "November" href="month.html">NOV</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-November">Income: ---</div>
                        <div class = "data expense-month" id = "expense-November">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-November">Budget: ---</div>
                </div>
                
                <div class = "col span-1-of-6">
                    <a class = "btn btn-full" id = "December" href="month.html">DEC</a>
                        <hr width = "70%">
                        <div class = "data income-month" id="income-December">Income: ---</div>
                        <div class = "data expense-month" id = "expense-December">Expense: ---</div>
                        <div class = "data budget-month" id = "budget-December">Budget: ---</div>
                </div>
                
            </div>
            
        </section>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://www.promisejs.org/polyfills/promise-6.1.0.js"></script>
        <script>
            
            function getYear(){
                var date = new Date();
                var year = date.getFullYear();  
                $('.year').text(year);
                return year;
            }
            
            function setListeners(){
                $("#prev-year").on("click", function(event){
                    console.log(parseInt($('.year').text()));
                    initial(parseInt($('.year').text())-1);
                })
                
                 $("#next-year").on("click", function(event){
                    initial(parseInt($('.year').text())+1);
                })
            }
            
            //Sets href attribute for all 'month' buttons
            function setLink(year){
                 $('#January').attr("href","http://localhost:3001/summary/"+year+"/January");
                $('#February').attr("href","http://localhost:3001/summary/"+year+"/February");
                $('#March').attr("href","http://localhost:3001/summary/"+year+"/March");
                $('#April').attr("href","http://localhost:3001/summary/"+year+"/April");
                $('#May').attr("href","http://localhost:3001/summary/"+year+"/May");
                $('#June').attr("href","http://localhost:3001/summary/"+year+"/June");
                $('#July').attr("href","http://localhost:3001/summary/"+year+"/July");
                $('#August').attr("href","http://localhost:3001/summary/"+year+"/August");
                $('#September').attr("href","http://localhost:3001/summary/"+year+"/September");
                $('#October').attr("href","http://localhost:3001/summary/"+year+"/October");
                $('#November').attr("href","http://localhost:3001/summary/"+year+"/November");
                $('#December').attr("href","http://localhost:3001/summary/"+year+"/December");
            }
           
            //Gets income, expense and budget for month/year
            function get(month, year){
                return new Promise(function(resolve, reject){
                    $.ajax({
                        url: "http://localhost:3000/",
                        type: "get",
                        data: {year:year, month:month},
                        dataType: 'json',
                        success: function(data){
                            $("#income-"+month).text("Income: "+formatNum(data.income));
                            $("#expense-"+month).text("Expense: "+formatNum(data.expense));
                            $("#budget-"+month).text("Budget: "+formatNum(data.budget));
                            resolve();
                        }
                    });
                })
            }
            
            //Formats the number so its divided by , every 3 figures.
            function formatNum(value){
                return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            function initial(year){
                setLink(year);
                $('.year').text(year);
                
                //Get data for every month of the specified year
                get('January',year).then(function(){
                    return get('February', year);
                }).then(function(){
                    return get('March', year);
                }).then(function(){
                    return get('April', year);
                }).then(function(){
                    return get('May', year);
                }).then(function(){
                    return get('June', year);
                }).then(function(){
                    return get('July', year);
                }).then(function(){
                    return get('August', year);
                }).then(function(){
                    return get('September', year);
                }).then(function(){
                    return get('October', year);
                }).then(function(){
                    return get('November', year);
                }).then(function(){
                    return get('December', year);
                })
            }
            

            $(document).ready(function() { 
              /*  getYear();
                var year = $('.year').text();
                setLink(year);*/
                setListeners();
                initial(getYear());
            })
        </script>
    </body>
    
    
</html>